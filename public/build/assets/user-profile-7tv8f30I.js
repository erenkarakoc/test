(function(){toastr.options={positionClass:"toast-top-center",timeOut:"1000",showDuration:"30",hideDuration:"30"};const o=document.querySelector("#updateUserProfileForm"),i=FormValidation.formValidation(o,{fields:{username:{validators:{notEmpty:{message:"Please enter a username"},stringLength:{min:8,message:"Username must be more than 8 characters"}}},full_name:{validators:{stringLength:{min:3,max:50,message:"Full name must be between 3 and 50 characters"},regexp:{regexp:/^[a-zA-Z\s]+$/,message:"Full name can only contain letters"}}},country:{validators:{}},phone_number:{validators:{callback:{message:"Please enter a valid phone number",callback:e=>e.value.trim()?libphonenumber.isValidNumber(e.value.trim()):!0}}},date_of_birth:{validators:{date:{format:"YYYY-MM-DD",message:"Please enter a valid date in YYYY-MM-DD format"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:"",rowSelector:".update-profile-info-row"}),autoFocus:new FormValidation.plugins.AutoFocus},init:e=>{e.on("plugins.message.placed",function(t){t.element.parentElement.classList.contains("input-group")&&t.element.parentElement.insertAdjacentElement("afterend",t.messageElement)})}}),l=async(e,t)=>(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify(t)})).json();o.addEventListener("submit",async e=>{if(e.preventDefault(),await i.validate()==="Valid"){const a=e.target,n=new FormData(a),c={username:n.get("username"),full_name:n.get("full_name"),country:n.get("country"),phone_number:n.get("phone_number"),date_of_birth:document.querySelector("#date_of_birth").value};(await l("/user/update-user-profile",c)).success&&toastr.success("Profile updated.")}else toastr.error("Please correct the errors before submitting.")}),document.addEventListener("click",e=>{const t=e.target.closest(".copy-recovery-code");if(t){const a=t.closest(".input-group").querySelector(".form-control");navigator.clipboard.writeText(a.value.trim()).then(()=>{a.select()})}});const s=document.querySelector("#date_of_birth"),r=document.querySelector("#clearDateOfBirth");s.addEventListener("input",e=>{e.target.value&&(r.style.display="block")}),r.addEventListener("click",()=>{s.value="",r.style.display="none"}),document.querySelectorAll(".nav-link").forEach(e=>{const t=e.getAttribute("data-bs-target");e.addEventListener("click",()=>{const a=new URL(window.location);a.searchParams.set("tab",t.replace("#","")),window.history.pushState({},"",a)})}),document.addEventListener("DOMContentLoaded",()=>{const e=new URLSearchParams(window.location.search);e.get("tab")&&new bootstrap.Tab(document.querySelector(`[data-bs-target="#${e.get("tab")}"]`)).show()})})();
