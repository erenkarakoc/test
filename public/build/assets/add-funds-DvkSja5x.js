(function(){toastr.options={positionClass:"toast-top-center",timeOut:"1000",showDuration:"30",hideDuration:"30"};const p=document.querySelector("#addFunds");if(typeof p!==void 0&&p!==null){const h=document.querySelector("#usdAmountInput"),f=document.querySelector("#assetAmountInput"),F=document.querySelectorAll('input[name="asset"]'),x=document.querySelectorAll(".chosen-asset-text"),C=document.querySelectorAll(".chosen-asset-network"),q=document.querySelector(".chosen-asset-price"),E=document.querySelectorAll(".chosen-asset-price-in-usd"),k=document.querySelectorAll(".chosen-asset-amount"),B=document.querySelectorAll(".chosen-asset-icon"),V=document.querySelectorAll(".chosen-asset-icon-sm");let o="",w="(TRC-20)",u=1,l=1,c=null,g="";F.forEach(e=>{e.addEventListener("change",async t=>{t.target.checked&&(o=t.target.value,w=o==="USDT"||o==="TRX"?"(TRC-20)":o==="ETH"||o==="ETC"?"(ERC-20)":o==="BNB"?"(BSC-20)":"",u=o==="USDT"?1:await window.getAssetPrice(o)||1,h.value="",f.value="",v())})}),f.addEventListener("keyup",e=>{l=parseFloat(e.target.value)||0,c=o==="USDT"?l:l*u,h.value=Number(c>0?c:"").toFixed(2),v()}),h.addEventListener("keyup",e=>{c=parseFloat(e.target.value)||0,l=o==="USDT"?c:c/u,f.value=Number(l>0?l:"").toFixed(2),v()});const v=()=>{const t=(JSON.parse(sessionStorage.getItem("assets-data"))||{})[o]||{};x.forEach(n=>n.textContent=o),C.forEach(n=>n.textContent=w),q.textContent=u,k.forEach(n=>n.textContent=Number(l).toFixed(2)),B.forEach(n=>n.innerHTML=t.iconLg),V.forEach(n=>n.innerHTML=t.iconSm),c&&E.forEach(n=>n.textContent=Number(c).toFixed(2))},y=async(e,t)=>(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify(t)})).json(),_=e=>{const t=document.querySelector("#payment-progress-timer"),n=20*60;let s=0;const r=setInterval(async()=>{s++;const d=Math.floor((n-s)/60),m=(n-s)%60;t.textContent=`${d.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`;const S=await y("check-tron-wallet-balance",{address_hex:e});(Number(S.usdt_balance_received)||Number(S.trx_balance_received))&&(clearInterval(r),a.next()),s>=n&&(clearInterval(r),t.textContent="0:00")},1e3)},I=async(e,t,n)=>{const s=await y("/create-transaction-for-tron",{asset:e,asset_price:Number(u),amount_in_asset:t,amount_in_usd:n}),r=await y("/generate-tron-wallet",{tnx_id:s.data.tnx_id,asset_price:Number(u)}),d=document.querySelector(".qr-code-wrapper img"),m=document.querySelectorAll(".tnxId"),S=document.querySelector("#walletAddress");g=s.data.tnx_id,m.forEach(T=>{T.innerHTML=`#TNX${g}`,T.setAttribute("href",`/transactions/${g}`)}),d.setAttribute("src",`data:image/png;base64,${r.qr_code}`),S.value=r.wallet_address,_(r.wallet_address)},N=async()=>{await y("/cancel-transaction",{tnx_id:g.toString()}),window.location.reload()};document.querySelector("#cancelPaymentButton").addEventListener("click",()=>{toastr.error(`<div class="d-flex flex-column" id="cancelTransactionToast">
              <span>Are you sure you want to cancel this transaction?</span>
              <div class="d-flex justify-content-end mt-4">
              <button type="button" class="btn btn-label-success btn-sm" id="cancelTransactionButtonToastContinue">Continue</button>
              <button type="button" class="btn btn-danger btn-sm ms-2" id="cancelTransactionButtonToastCancel">Cancel</button>
              </div>
          </div>`,"Cancel Transaction",{timeOut:0,extendedTimeOut:0,onShown:function(){const e=document.querySelector("#cancelTransactionToast"),t=e.querySelector("#cancelTransactionButtonToastContinue");e.querySelector("#cancelTransactionButtonToastCancel").addEventListener("click",()=>{N()}),t.addEventListener("click",()=>{toastr.clear()})}})});const i=p.querySelector("#addFundsForm"),P=i.querySelector("#chooseAssetStep"),L=i.querySelector("#enterAmountStep"),D=i.querySelector("#summaryStep"),R=i.querySelector("#proceedStep"),U=[].slice.call(i.querySelectorAll(".btn-next")),M=[].slice.call(i.querySelectorAll(".btn-prev"));let a=new Stepper(p,{linear:!0});const O=FormValidation.formValidation(P,{fields:{asset:{validators:{notEmpty:{message:"Please choose an asset to proceed"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:""}),autoFocus:new FormValidation.plugins.AutoFocus,submitButton:new FormValidation.plugins.SubmitButton},init:e=>{e.on("plugins.message.placed",function(t){document.querySelector(".choose-asset-error-message").appendChild(t.messageElement)})}}).on("core.form.valid",function(){a.next()}),j=FormValidation.formValidation(L,{fields:{asset_amount:{validators:{notEmpty:{message:"Please type an amount"}}},usd_amount:{validators:{notEmpty:{message:"Please type an amount"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:""}),autoFocus:new FormValidation.plugins.AutoFocus,submitButton:new FormValidation.plugins.SubmitButton},init:e=>{e.on("plugins.message.placed",function(t){t.element.parentElement.classList.contains("enter-amount-col")&&t.element.parentElement.insertAdjacentElement("afterend",t.messageElement)})}}).on("core.form.valid",function(){a.next()}),H=FormValidation.formValidation(D,{plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:""}),autoFocus:new FormValidation.plugins.AutoFocus,submitButton:new FormValidation.plugins.SubmitButton},init:e=>{e.on("plugins.message.placed",function(t){document.querySelector(".choose-asset-error-message").appendChild(t.messageElement)})}}).on("core.form.valid",function(){a.next()}),W=FormValidation.formValidation(R,{plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:""}),autoFocus:new FormValidation.plugins.AutoFocus,submitButton:new FormValidation.plugins.SubmitButton},init:e=>{e.on("plugins.message.placed",function(t){document.querySelector(".choose-asset-error-message").appendChild(t.messageElement)})}}).on("core.form.valid",function(){a.next()});U.forEach(e=>{e.addEventListener("click",async t=>{switch(a._currentIndex){case 0:O.validate();break;case 1:j.validate();break;case 2:const n=document.querySelector("#payNowButton");n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="16" stroke-dashoffset="16" d="M12 3c4.97 0 9 4.03 9 9"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="16;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path><path stroke-dasharray="64" stroke-dashoffset="64" stroke-opacity=".3" d="M12 3c4.97 0 9 4.03 9 9c0 4.97 -4.03 9 -9 9c-4.97 0 -9 -4.03 -9 -9c0 -4.97 4.03 -9 9 -9Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.2s" values="64;0"/></path></g></svg>';const s=new FormData(i),r=s.get("asset"),d=s.get("asset_amount"),m=s.get("usd_amount");r==="USDT"||r==="TRX"?(await I(r,d,m),H.validate()):alert("not tron");break;case 3:W.validate();break}})}),M.forEach(e=>{e.addEventListener("click",t=>{switch(a._currentIndex){case 3:a.previous();break;case 2:a.previous();break;case 1:a.previous();break}})});const b=document.querySelector(".wallet-address-wrapper"),A=b.querySelector("#walletAddress");b.addEventListener("click",()=>{const e=document.querySelector(".wallet-address-popover");navigator.clipboard.writeText(A.value.trim()),e.style.left="12px",e.querySelector(".popover-body").textContent="Copied",e.querySelector(".popover-arrow").style.transform="translate(23px, 0px)",A.select()});const $=document.querySelector(".chosen-asset-amount-wrapper"),X=document.querySelector("#chosenAssetAmount");$.addEventListener("click",()=>{const e=document.querySelector(".chosen-asset-amount-popover");navigator.clipboard.writeText(X.textContent),e.style.left="12px",e.querySelector(".popover-body").textContent="Copied",e.querySelector(".popover-arrow").style.transform="translate(23px, 0px)"})}})();
