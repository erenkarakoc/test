(function(){const i=JSON.parse(sessionStorage.getItem("assets-data")),w=document.querySelector("#manageWalletForm"),v=document.querySelector("#addWalletModalForm");let c,d=null;const W=()=>{const e=document.querySelector("#addWalletAssetSelect").value,l=e==="BTC"?/^(bc1|[13])[a-zA-HJ-NP-Z0-9]{25,39}$/:e==="ETC"?/0x[a-fA-F0-9]{40}$/:e==="ETH"?/0x[a-fA-F0-9]{40}$/:e==="BNB"?/0x[a-fA-F0-9]{40}$/:e==="USDT"?/^T[A-Za-z0-9]{33}$/:e==="TRX"?/^T[A-Za-z0-9]{33}$/:e==="LTC"?/^[LM3][a-km-zA-HJ-NP-Z1-9]{26,33}$/:/.*$/,a=document.querySelector("#addModalAssetLabel").getAttribute("data-existing-labels").split(", ").map(n=>n.trim()).filter(n=>n!==void 0);return FormValidation.formValidation(v,{fields:{wallet_address:{validators:{notEmpty:{message:"Please enter a wallet address"},regexp:{regexp:l,message:`Please enter a valid ${e} address`}}},label:{validators:{stringLength:{max:30,message:"Label cannot exceed 30 characters"},callback:{message:"A wallet with this label already exists",callback:n=>!a.includes(n.value.trim())}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:"",rowSelector:".add-wallet-form-row"}),autoFocus:new FormValidation.plugins.AutoFocus},init:n=>{n.on("plugins.message.placed",function(t){t.element.parentElement.classList.contains("input-group")&&t.element.parentElement.insertAdjacentElement("afterend",t.messageElement)})}})},m=()=>{d&&d.destroy(),d=W()},L=()=>{const e=sessionStorage.getItem("current-symbol"),l=e==="BTC"?/^(bc1|[13])[a-zA-HJ-NP-Z0-9]{25,39}$/:e==="ETC"?/0x[a-fA-F0-9]{40}$/:e==="ETH"?/0x[a-fA-F0-9]{40}$/:e==="USDT"?/^T[A-Za-z0-9]{33}$/:e==="TRX"?/^T[A-Za-z0-9]{33}$/:e==="LTC"?/^[LM3][a-km-zA-HJ-NP-Z1-9]{26,33}$/:/.*$/,a=document.querySelector("#manageModalAssetLabel").value,n=document.querySelector("#manageModalAssetLabel").getAttribute("data-existing-labels").split(", ").map(t=>t.trim()).filter(t=>t!==a);return FormValidation.formValidation(w,{fields:{wallet_address:{validators:{notEmpty:{message:"Please enter a wallet address"},regexp:{regexp:l,message:`Please enter a valid ${e} address`}}},label:{validators:{stringLength:{max:30,message:"Label cannot exceed 30 characters"},callback:{message:"A wallet with this label already exists",callback:t=>!n.includes(t.value.trim())}}},active:{},symbol:{}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:"",rowSelector:".manage-wallet-form-row"}),autoFocus:new FormValidation.plugins.AutoFocus},init:t=>{t.on("plugins.message.placed",function(o){o.element.parentElement.classList.contains("input-group")&&o.element.parentElement.insertAdjacentElement("afterend",o.messageElement)})}})},x=()=>{c&&c.destroy(),c=L()},y=document.querySelector("#addWalletAssetSelect"),u=document.querySelector("#addWalletAddressInput"),E=document.querySelector("#addWalletAssetIcon"),g=e=>{const l=e?e.target.value:null,a=l?i[l]:i[y.value];E.innerHTML=a.iconSm,u.setAttribute("placeholder",a.placeholder),u.setAttribute("aria-label",a.placeholder)};g(),m();const f=document.querySelector(".addWalletModalToggle");f&&f.addEventListener("click",()=>{g(),m()}),y.addEventListener("change",e=>{g(e),m()}),document.querySelector("#addWalletPasteButton").addEventListener("click",async()=>{const e=await navigator.clipboard.readText();e&&(u.value=e)});const b=document.querySelector("#manageWalletAddressInput"),q=document.querySelector("#manageWalletAssetIcon"),M=document.querySelector("#manageWalletModalIcon"),C=e=>{const l=e?i[e]:i.USDT;q.innerHTML=l.iconSm,M.innerHTML=l.iconLg,b.setAttribute("placeholder",l.placeholder),b.setAttribute("aria-label",l.placeholder)};document.querySelector("#manageWalletPasteButton").addEventListener("click",async()=>{const e=await navigator.clipboard.readText();e&&(b.value=e)});const k=document.querySelectorAll(".toggle-manage-modal-button"),r=document.querySelector("#manageWalletModal"),h=document.querySelector("#manageWalletModalSymbol"),D=r.querySelector("#manageWalletModalTitle"),F=r.querySelector("#manageWalletModalSymbolLabel"),B=r.querySelector("#manageWalletAddressInput"),P=r.querySelector("#manageModalAssetLabel"),S=r.querySelector("#manageWalletActiveSwitch"),A=r.querySelector("#manageWalletActiveLabel");k.forEach(e=>e.addEventListener("click",()=>{const l=e.getAttribute("data-id"),a=e.getAttribute("data-symbol"),n=e.getAttribute("data-title"),t=e.getAttribute("data-address"),o=e.getAttribute("data-label"),s=e.getAttribute("data-active");h.value=a,h.setAttribute("data-wallet-id",l),D.innerHTML=`${n} Wallet`,F.innerHTML=`${a} ${a==="USDT"||a==="TRX"?'<span class="text-light">(TRC-20)</span>':a==="ETH"||a==="ETC"?'<span class="text-light">(ERC-20)</span>':""}`,B.value=t||"",P.value=o||"",S.checked=s==="true",A.innerHTML=s==="true"?"Active":"Inactive",sessionStorage.setItem("current-symbol",a),x(),C(a)})),S.addEventListener("change",e=>{A.innerHTML=e.target.checked?"Active":"Inactive"});const T={chart:{height:60,type:"area",toolbar:{show:!1},sparkline:{enabled:!0}},markers:{colors:"transparent",strokeColors:"transparent"},grid:{show:!1,padding:{top:5}},colors:[config.colors.primary],fill:{type:"gradient",gradient:{shade:config.colors.primary,shadeIntensity:.5,opacityFrom:.3,opacityTo:.1}},dataLabels:{enabled:!1},stroke:{width:2,curve:"smooth"},xaxis:{show:!0,lines:{show:!1},labels:{show:!1},stroke:{width:0},axisBorder:{show:!1}},yaxis:{stroke:{width:0},show:!1},tooltip:{enabled:!1},responsive:[{breakpoint:1387,options:{chart:{height:80}}},{breakpoint:1200,options:{chart:{height:123}}}]},I=setInterval(()=>{const e=localStorage.getItem("asset-chart-data");e&&e!=="loading"&&(JSON.parse(e).forEach(a=>{const n=document.querySelector(".wallet-asset-chart-"+a.title),t=a.data.map(o=>({x:new Date(o.time).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit"}),y:o.close}));T.series=[{name:a.title,data:t}],n&&(document.querySelector(".wallet-item-"+a.title).querySelector(".price-hidden").classList.remove("price-hidden"),new ApexCharts(n,T).render())}),clearInterval(I))},200);toastr.options={positionClass:"toast-top-center",timeOut:"1000",showDuration:"30",hideDuration:"30"},w.addEventListener("submit",e=>{e.preventDefault(),c.validate().then(l=>{if(l==="Valid"){const a=e.target.querySelector('button[type="submit"]');a.disabled=!0;const n=e.target,t=new FormData(n);t.set("id",n.querySelector("[data-wallet-id]").getAttribute("data-wallet-id")),t.set("active",n.elements.active.checked),fetch(n.action,{method:"POST",body:t,headers:{"X-CSRF-TOKEN":$("meta[name='csrf-token']").attr("content")}}).then(o=>o.json()).then(o=>{if(o.success){const s=o.data;toastr.success(`<div class="d-flex align-items-center">${s.title} wallet updated.</div>`),window.location.href=window.location.pathname+"?tab=manage"}else toastr.error(`<div class="d-flex align-items-center">Something went wrong while updating ${t.get("title")} wallet. Please try again.</div>`)}).catch(()=>{toastr.error(`<div class="d-flex align-items-center">Something went wrong while updating ${t.get("title")} wallet. Please try again.</div>`)})}})}),v.addEventListener("submit",e=>{e.preventDefault(),d.validate().then(l=>{if(l==="Valid"){const a=e.target.querySelector('button[type="submit"]');a.disabled=!0;const n=e.target,t=new FormData(n),o=n.elements.symbol.querySelector("[value="+t.get("symbol")+"]").getAttribute("data-title");t.set("title",o),fetch(n.action,{method:"POST",body:t,headers:{"X-CSRF-TOKEN":$("meta[name='csrf-token']").attr("content")}}).then(s=>s.json()).then(s=>{s.success?(toastr.success(`<div class="d-flex align-items-center">${t.get("symbol")} wallet added.</div>`),window.location.href=window.location.pathname+"?tab=manage"):toastr.error(`<div class="d-flex align-items-center">Something went wrong while adding ${t.get("symbol")} wallet. Please try again.</div>`)}).catch(()=>{toastr.error(`<div class="d-flex align-items-center">Something went wrong while adding ${t.get("symbol")} wallet. Please try again.</div>`)})}})}),document.querySelector("#manageWalletRemoveButton").addEventListener("click",e=>{e.preventDefault();const l=h.value,n={id:document.querySelector("[data-wallet-id]").getAttribute("data-wallet-id")};toastr.error(`<div class="d-flex flex-column" id="removeWalletToast">
            <span>Are you sure you want to remove the <span class="fw-bold text-white">${l}</span> wallet?</span>
            <div class="d-flex justify-content-end mt-4">
            <button type="button" class="btn btn-label-danger btn-sm" id="removeWalletButtonToastCancel">Cancel</button>
            <button type="button" class="btn btn-danger btn-sm ms-2" id="removeWalletButtonToastDelete">Delete</button>
            </div>
        </div>`,"Confirm Removal",{timeOut:0,extendedTimeOut:0,onShown:function(){const t=document.querySelector("#removeWalletToast"),o=t.querySelector("#removeWalletButtonToastCancel");t.querySelector("#removeWalletButtonToastDelete").addEventListener("click",()=>{fetch("/remove-wallet",{method:"POST",headers:{"X-CSRF-TOKEN":$("meta[name='csrf-token']").attr("content"),"Content-Type":"application/json"},body:JSON.stringify(n)}).then(p=>p.json()).then(p=>{p.success?toastr.success(`<div class="d-flex align-items-center">${l} wallet removed.</div>`):toastr.error(`<div class="d-flex align-items-center">Something went wrong while removing ${l} wallet. Please try again.</div>`),window.location.href=window.location.pathname+"?tab=manage"}).catch(()=>{toastr.error(`<div class="d-flex align-items-center">Something went wrong while removing ${l} wallet. Please try again.</div>`)})}),o.addEventListener("click",()=>{toastr.clear()})}})}),document.querySelectorAll(".nav-link").forEach(e=>{const l=e.getAttribute("data-bs-target");e.addEventListener("click",()=>{const a=new URL(window.location);a.searchParams.set("tab",l.replace("#","")),window.history.pushState({},"",a)})}),document.addEventListener("DOMContentLoaded",()=>{const e=new URLSearchParams(window.location.search);e.get("tab")&&new bootstrap.Tab(document.querySelector(`[data-bs-target="#${e.get("tab")}"]`)).show()})})();
