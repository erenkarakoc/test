<?php
namespace App\Http\Controllers;

use App\Models\Notification;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;

class NotificationController extends Controller
{
  private $icons = [
    'received' => '<svg width="22" height="22" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10" opacity=".5"></circle><path stroke-linecap="round" stroke-linejoin="round" d="m15 9l-6 6m0 0v-4.5M9 15h4.5"></path></g></svg>',
    'sent' => '<svg width="22" height="22" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" fill="none"><path opacity="0.5" d="M14 25.6667C20.4433 25.6667 25.6667 20.4433 25.6667 14C25.6667 7.55668 20.4433 2.33333 14 2.33333C7.55668 2.33333 2.33333 7.55668 2.33333 14C2.33333 20.4433 7.55668 25.6667 14 25.6667Z" stroke="currentColor" stroke-width="1.75"></path><path d="M10.5 17.5L17.5 10.5M17.5 10.5L17.5 15.75M17.5 10.5L12.25 10.5" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round"></path></svg>',
    'locked' => '<svg width="22" height="22" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg"><path opacity="0.5" fill-rule="evenodd" clip-rule="evenodd" d="M40 9.16667C22.9712 9.16667 9.16667 22.9712 9.16667 40C9.16667 57.0288 22.9712 70.8333 40 70.8333C57.0288 70.8333 70.8333 57.0288 70.8333 40C70.8333 22.9712 57.0288 9.16667 40 9.16667ZM4.16667 40C4.16667 20.2098 20.2098 4.16667 40 4.16667C59.7902 4.16667 75.8333 20.2098 75.8333 40C75.8333 59.7902 59.7902 75.8333 40 75.8333C20.2098 75.8333 4.16667 59.7902 4.16667 40Z" fill="currentColor" /><path opacity="0.5" d="M22 46.9389C22 41.9549 22 39.4612 23.5491 37.9139C25.0965 36.3647 27.5902 36.3647 32.5741 36.3647H46.673C51.6569 36.3647 54.1506 36.3647 55.698 37.9139C57.2471 39.4612 57.2471 41.9549 57.2471 46.9389C57.2471 51.9228 57.2471 54.4165 55.698 55.9639C54.1506 57.513 51.6569 57.513 46.673 57.513H32.5741C27.5902 57.513 25.0965 57.513 23.5491 55.9639C22 54.4165 22 51.9228 22 46.9389Z" fill="currentColor" /><path d="M30.9786 33.8959C30.9786 31.442 31.9534 29.0886 33.6886 27.3535C35.4237 25.6183 37.7771 24.6435 40.231 24.6435C42.6849 24.6435 45.0382 25.6183 46.7734 27.3535C48.5085 29.0886 49.4833 31.442 49.4833 33.8959V36.5694C50.4826 36.5782 51.3585 36.6012 52.1269 36.6576V33.8959C52.1269 30.7409 50.8735 27.7151 48.6426 25.4842C46.4117 23.2533 43.386 22 40.231 22C37.076 22 34.0502 23.2533 31.8193 25.4842C29.5884 27.7151 28.3351 30.7409 28.3351 33.8959V36.6593C29.2151 36.6018 30.0967 36.5718 30.9786 36.5694V33.8959Z" fill="currentColor" /><path d="M42.7233 50.4871C42.0623 51.1481 41.1658 51.5194 40.231 51.5194C39.2962 51.5194 38.3996 51.1481 37.7386 50.4871C37.0776 49.8261 36.7063 48.9295 36.7063 47.9947C36.7063 47.0599 37.0776 46.1634 37.7386 45.5024C38.3996 44.8414 39.2962 44.47 40.231 44.47C41.1658 44.47 42.0623 44.8414 42.7233 45.5024C43.3843 46.1634 43.7557 47.0599 43.7557 47.9947C43.7557 48.9295 43.3843 49.8261 42.7233 50.4871Z" fill="currentColor" /></svg>',
    'swap' => '<svg width="22" height="22" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.75522 12.5353C8.60151 12.5353 8.45148 12.4883 8.32516 12.4006C8.19884 12.313 8.10225 12.1888 8.04829 12.0448C7.99434 11.9007 7.98558 11.7437 8.02319 11.5945C8.0608 11.4453 8.143 11.3112 8.25879 11.21L11.7197 8.18663C11.8706 8.05472 12.0677 7.98821 12.2675 8.00172C12.4674 8.01523 12.6538 8.10767 12.7856 8.25868C12.9174 8.4097 12.9838 8.60693 12.9703 8.80699C12.9568 9.00705 12.8645 9.19354 12.7136 9.32545L10.7691 11.0236H18.8248C19.0251 11.0236 19.2172 11.1032 19.3588 11.245C19.5004 11.3867 19.58 11.579 19.58 11.7795C19.58 11.9799 19.5004 12.1722 19.3588 12.3139C19.2172 12.4557 19.0251 12.5353 18.8248 12.5353H8.75522ZM14.8674 18.2647C14.7211 18.3977 14.6328 18.5829 14.6213 18.7804C14.6099 18.9779 14.6763 19.172 14.8062 19.3211C14.9362 19.4702 15.1194 19.5623 15.3165 19.5777C15.5135 19.5931 15.7088 19.5306 15.8603 19.4035L19.3212 16.3801C19.437 16.2789 19.5192 16.1448 19.5568 15.9956C19.5944 15.8465 19.5857 15.6894 19.5317 15.5453C19.4777 15.4013 19.3812 15.2772 19.2548 15.1895C19.1285 15.1019 18.9785 15.0549 18.8248 15.0548H8.75522C8.55492 15.0548 8.36283 15.1345 8.2212 15.2762C8.07957 15.418 8 15.6102 8 15.8107C8 16.0111 8.07957 16.2034 8.2212 16.3452C8.36283 16.4869 8.55492 16.5665 8.75522 16.5665H16.8109L14.8674 18.2647Z" fill="currentColor" /><path opacity="0.5" fill-rule="evenodd" clip-rule="evenodd" d="M1 13.5417C1 6.6151 6.6151 1 13.5417 1C20.4682 1 26.0834 6.6151 26.0834 13.5417C26.0834 20.4682 20.4682 26.0834 13.5417 26.0834C6.6151 26.0834 1 20.4682 1 13.5417ZM13.5417 2.75C7.5816 2.75 2.75 7.5816 2.75 13.5417C2.75 19.5017 7.5816 24.3334 13.5417 24.3334C19.5017 24.3334 24.3334 19.5017 24.3334 13.5417C24.3334 7.5816 19.5017 2.75 13.5417 2.75Z" fill="currentColor" /></svg>',
    'bonus' => '<svg width="22" height="22" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg"><path opacity="0.5" fill-rule="evenodd" clip-rule="evenodd" d="M49.9987 11.4609C28.7127 11.4609 11.457 28.7166 11.457 50.0026C11.457 71.2886 28.7127 88.5443 49.9987 88.5443C71.2847 88.5443 88.5404 71.2886 88.5404 50.0026C88.5404 28.7166 71.2847 11.4609 49.9987 11.4609ZM5.20703 50.0026C5.20703 25.2648 25.2609 5.21094 49.9987 5.21094C74.7365 5.21094 94.7904 25.2648 94.7904 50.0026C94.7904 74.7404 74.7365 94.7943 49.9987 94.7943C25.2609 94.7943 5.20703 74.7404 5.20703 50.0026Z" fill="currentColor" /><path d="M58.545 44.7468C57.7827 44.7468 57.0516 44.4441 56.5126 43.9052C55.9735 43.3663 55.6707 42.6355 55.6707 41.8734C55.6707 41.1113 55.9735 40.3805 56.5126 39.8416C57.0516 39.3027 57.7827 39 58.545 39H68.1258C68.8881 39 69.6191 39.3027 70.1582 39.8416C70.6972 40.3805 71 41.1113 71 41.8734V51.4514C71 52.2135 70.6972 52.9444 70.1582 53.4832C69.6191 54.0221 68.8881 54.3249 68.1258 54.3249C67.3635 54.3249 66.6324 54.0221 66.0934 53.4832C65.5543 52.9444 65.2515 52.2135 65.2515 51.4514V48.8079L57.5371 56.5201C56.2795 57.7765 54.5743 58.4822 52.7965 58.4822C51.0186 58.4822 49.3135 57.7765 48.0559 56.5201L41.9778 50.4438C41.8888 50.3546 41.7831 50.2839 41.6667 50.2356C41.5503 50.1873 41.4255 50.1624 41.2995 50.1624C41.1735 50.1624 41.0487 50.1873 40.9323 50.2356C40.8159 50.2839 40.7102 50.3546 40.6212 50.4438L31.8337 59.2288C31.2888 59.7364 30.5682 60.0127 29.8235 59.9996C29.0789 59.9864 28.3685 59.6849 27.8418 59.1584C27.3152 58.6319 27.0136 57.9217 27.0004 57.1773C26.9873 56.4329 27.2637 55.7124 27.7714 55.1677L36.5589 46.3827C37.8165 45.1264 39.5216 44.4207 41.2995 44.4207C43.0774 44.4207 44.7825 45.1264 46.0401 46.3827L52.1182 52.459C52.2071 52.5482 52.3129 52.619 52.4293 52.6673C52.5457 52.7156 52.6705 52.7404 52.7965 52.7404C52.9225 52.7404 53.0473 52.7156 53.1637 52.6673C53.2801 52.619 53.3858 52.5482 53.4748 52.459L61.1854 44.7468H58.545Z" fill="currentColor" /></svg>',
    'trade_profit' => '',
    'trade_loss' => '',
    'bundled_pack_deployed' => '<svg width="22" height="22" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M10 21c-3.771 0-5.657 0-6.828-1.172S2 16.771 2 13v-.25h20V13c0 1.12 0 2.073-.03 2.89l-.015-.01c-.479-1.352-1.728-2.38-3.288-2.38c-1.512 0-2.728.96-3.239 2.25H13.5a.75.75 0 0 0 0 1.5h.857a3.16 3.16 0 0 0-.857 2.162c0 .567.154 1.115.43 1.588zm0-18h4c3.771 0 5.657 0 6.828 1.172S22 7.229 22 11v.25H2V11c0-3.771 0-5.657 1.172-6.828S6.229 3 10 3" opacity=".5"/><path fill="currentColor" fill-rule="evenodd" d="M20.654 16.88c-.111-1.057-.958-1.88-1.987-1.88c-.845 0-1.568.555-1.861 1.34a2.22 2.22 0 0 0-.015 1.513a1.46 1.46 0 0 0-1.4.49A1.63 1.63 0 0 0 15 19.412c0 .877.672 1.588 1.5 1.588H20c1.105 0 2-.948 2-2.118c0-.927-.562-1.714-1.346-2.001" clip-rule="evenodd"/><path fill="currentColor" d="M20.654 16.88c-.111-1.057-.958-1.88-1.987-1.88c-.845 0-1.568.555-1.861 1.34a2.22 2.22 0 0 0-.015 1.513a1.46 1.46 0 0 0-1.4.49A1.63 1.63 0 0 0 15 19.412c0 .877.672 1.588 1.5 1.588H20c1.105 0 2-.948 2-2.118c0-.927-.562-1.714-1.346-2.001M12.75 7.5a.75.75 0 0 1 .75-.75H18a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1-.75-.75M6 18.25a.75.75 0 0 1-.75-.75v-2a.75.75 0 0 1 1.5 0v2a.75.75 0 0 1-.75.75m0-9a.75.75 0 0 1-.75-.75v-2a.75.75 0 0 1 1.5 0v2a.75.75 0 0 1-.75.75m3 9a.75.75 0 0 1-.75-.75v-2a.75.75 0 0 1 1.5 0v2a.75.75 0 0 1-.75.75m0-9a.75.75 0 0 1-.75-.75v-2a.75.75 0 0 1 1.5 0v2a.75.75 0 0 1-.75.75"/><path fill="currentColor" fill-rule="evenodd" d="M22 12.75H2v-1.5h20z" clip-rule="evenodd"/></svg>',
    'bundled_pack_activated' => '<svg width="22" height="22" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M3.172 19.828C4.343 21 6.229 21 10 21h3.89a5.47 5.47 0 0 1-.89-3q0-.452.07-.885a.75.75 0 0 1 .41-1.365a5.52 5.52 0 0 1 3.376-3H2V13c0 3.771 0 5.657 1.172 6.828m0-15.656C2 5.343 2 7.229 2 11v.25h20V11c0-3.771 0-5.657-1.172-6.828S17.771 3 14 3h-4C6.229 3 4.343 3 3.172 4.172" opacity=".5"/><path fill="currentColor" d="M14.929 16.753c.389-1.497 1.924-2.503 3.576-2.503c1.277 0 2.44.58 3.106 1.515a.75.75 0 1 1-1.222.87c-.36-.505-1.048-.885-1.884-.885c-.967 0-1.687.482-2 1.08a.75.75 0 0 1 .15 1.24l-.583.5a.75.75 0 0 1-.976 0l-.584-.5a.75.75 0 0 1 .417-1.317"/><path fill="currentColor" fill-rule="evenodd" d="M20.928 17.43a.75.75 0 0 1 .976 0l.584.5a.75.75 0 0 1-.417 1.317c-.389 1.497-1.924 2.503-3.576 2.503c-1.277 0-2.44-.58-3.106-1.515a.75.75 0 1 1 1.222-.87c.36.505 1.048.885 1.884.885c.967 0 1.687-.482 2-1.08a.75.75 0 0 1-.15-1.24z" clip-rule="evenodd"/><path fill="currentColor" d="M5.25 17.5a.75.75 0 0 0 1.5 0v-2a.75.75 0 0 0-1.5 0zm3 0a.75.75 0 0 0 1.5 0v-2a.75.75 0 0 0-1.5 0zm0-9a.75.75 0 0 0 1.5 0v-2a.75.75 0 0 0-1.5 0zM6 9.25a.75.75 0 0 1-.75-.75v-2a.75.75 0 0 1 1.5 0v2a.75.75 0 0 1-.75.75m7.5-2.5a.75.75 0 0 0 0 1.5H18a.75.75 0 0 0 0-1.5z"/><path fill="currentColor" fill-rule="evenodd" d="M20.144 12.75H22v-1.5H2v1.5h14.856a5.5 5.5 0 0 1 1.644-.25a5.5 5.5 0 0 1 1.644.25" clip-rule="evenodd"/></svg>',
    'locked_pack' => '<svg width="22" height="22" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M3.172 19.828C4.343 21 6.229 21 10 21h3.89a5.47 5.47 0 0 1-.89-3q0-.452.07-.885a.75.75 0 0 1 .41-1.365a5.52 5.52 0 0 1 3.376-3H2V13c0 3.771 0 5.657 1.172 6.828m0-15.656C2 5.343 2 7.229 2 11v.25h20V11c0-3.771 0-5.657-1.172-6.828S17.771 3 14 3h-4C6.229 3 4.343 3 3.172 4.172" opacity=".5"/><path fill="currentColor" d="M14.929 16.753c.389-1.497 1.924-2.503 3.576-2.503c1.277 0 2.44.58 3.106 1.515a.75.75 0 1 1-1.222.87c-.36-.505-1.048-.885-1.884-.885c-.967 0-1.687.482-2 1.08a.75.75 0 0 1 .15 1.24l-.583.5a.75.75 0 0 1-.976 0l-.584-.5a.75.75 0 0 1 .417-1.317"/><path fill="currentColor" fill-rule="evenodd" d="M20.928 17.43a.75.75 0 0 1 .976 0l.584.5a.75.75 0 0 1-.417 1.317c-.389 1.497-1.924 2.503-3.576 2.503c-1.277 0-2.44-.58-3.106-1.515a.75.75 0 1 1 1.222-.87c.36.505 1.048.885 1.884.885c.967 0 1.687-.482 2-1.08a.75.75 0 0 1-.15-1.24z" clip-rule="evenodd"/><path fill="currentColor" d="M5.25 17.5a.75.75 0 0 0 1.5 0v-2a.75.75 0 0 0-1.5 0zm3 0a.75.75 0 0 0 1.5 0v-2a.75.75 0 0 0-1.5 0zm0-9a.75.75 0 0 0 1.5 0v-2a.75.75 0 0 0-1.5 0zM6 9.25a.75.75 0 0 1-.75-.75v-2a.75.75 0 0 1 1.5 0v2a.75.75 0 0 1-.75.75m7.5-2.5a.75.75 0 0 0 0 1.5H18a.75.75 0 0 0 0-1.5z"/><path fill="currentColor" fill-rule="evenodd" d="M20.144 12.75H22v-1.5H2v1.5h14.856a5.5 5.5 0 0 1 1.644-.25a5.5 5.5 0 0 1 1.644.25" clip-rule="evenodd"/></svg>',
  ];

  public function sendNotification($user_id, $type, $title, $html_content, $text_content, $link)
  {
    $icon = $this->icons[$type];

    Notification::create([
      'user_id' => $user_id,
      'type' => $type,
      'icon' => $icon ?? null,
      'title' => $title,
      'text_content' => $text_content ?? null,
      'html_content' => $html_content ?? null,
      'link' => $link ?? null,
    ]);
  }

  public function markAllAsRead()
  {
    $user_id = Auth::user()->id;
    $unreadNotifications = Notification::where('user_id', $user_id)->where('read', 0)->get();

    foreach ($unreadNotifications as $notification) {
      $notification->read = 1;
      $notification->save();
    }
  }

  public function markAsRead(Request $request)
  {
    $request->validate([
      'notification_id' => 'required|integer',
    ]);

    $notification = Notification::where('id', $request->notification_id)->first();

    $notification->read = 1;
    $notification->save();
  }
}
